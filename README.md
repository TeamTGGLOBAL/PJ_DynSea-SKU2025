# Project DynSea SKU (プロジェクト ダイナシーエスケーユー)

[![Project Status: Active](https://www.repostatus.org/badges/latest/active.svg)](https://www.repostatus.org/#active)

**「情報の粒度」を自在に操り、水産業の未来をデータで描く。**

## 1. 私たちが解くべき「本当の課題」

生鮮海産物の世界は、常に「不確実性」との戦いです。このプロジェクトは当初、「SKUの多さ」や「データ化の困難さ」を課題として捉えていました。しかし、議論を深める中で、私たちはより本質的な課題にたどり着きました。

それは、**「ビジネスの場面ごとに要求される情報の『粒度』を、柔軟かつ効率的に制御できないこと」**です。

### 粒度のミスマッチが引き起こす問題

*   **大まかな見積もりが欲しい時:**
    *   **要求:** `「ヒラメ、だいたいいくら？」`
    *   **現状:** 個別の細かいデータしかなく、瞬時に相場を提示できない。
*   **サイズ別の在庫を知りたい時:**
    *   **要求:** `「ヒラメの大きいやつ、何枚ある？」`
    *   **現状:** 「ヒラメ」という大雑把な括りでしか管理しておらず、正確な在庫が分からない。
*   **詳細なトレーサビリティ情報が必要な時:**
    *   **要求:** `「あの料亭に納品したヒラメ、いつ誰が獲ったやつ？」`
    *   **現状:** そもそも個体レベルで管理されていないため、追跡が不可能。

*   **現状のシステム・慣行の限界:**
    *   従来の管理方法（手書き伝票、Excel、固定SKUシステム）は、**特定の粒度にしか対応できない**という問題を抱えています。
    *   「鮃 1,200円/kg」という粗い情報しか管理していなければ、サイズ別の詳細な問い合わせには応えられません。
    *   逆に、全ての魚を個体レベルで管理しようとすると、SKUが爆発し、大まかな見積もりを出す際に集計が非常に煩雑になります。

このように、現場では**粗い粒度から細かい粒度まで、様々なレベルの情報**が求められます。しかし、従来の管理手法は特定の粒度にしか対応できず、この「粒度のミスマッチ」が非効率、機会損失、そして情報の不透明性を生み出していたのです。


**革新的なアプローチ：階層的データモデルのセクション**

## 2. 私たちのアプローチ：階層的データモデル

この「粒度の壁」を打ち破るため、私たちは**JSONのような階層構造で海産物データを管理する**という、新しいアプローチを採用します。このモデルは、私たちの徹底した議論とシミュレーションを経て、より実践的で堅牢な形へと進化しました。

### 考え方：3つの階層で、全ての情報を整理する

*   **親 (Product):** 「ヒラメ」とは何か？という普遍的な情報を管理する**マスター**。
*   **子 (Variant):** 「ヒラメの、大サイズで、活締めで、5kg箱で、3-4尾入りの規格」といった、市場で取引される**「型」のマスター**。
*   **孫 (Lot):** 「本日、その型の箱が、実重量5.1kgで、8,800円で入荷した」という、日々の**「出来事」のトランザクション**。

この3階層のリレーションシップにより、情報の粒度を自在にコントロールします。

### データモデルの概念図（最終版）

これは、GASやAPIを通じてシステムが出力するJSONデータのイメージです。各階層の情報が、明確に分離されつつも連携していることがわかります。

```json
{
  "product_id": "prod_hirame",
  "product_name": "ヒラメ",
  "category_name": "鮮魚",
  "description": "日本近海で獲れる高級魚。刺身やムニエルに最適。",
  "variants": [
    {
      "variant_id": "var_0001",
      "variant_name": "ヒラメ中(A品/活締/5kg箱/3-4尾)",
      "size_name": "中",
      "quality_name": "A品",
      "processing_name": "活締め",
      "temperature_name": "冷蔵",
      "package_name": "5kg発泡箱",
      "item_count_spec": "3-4尾",
      "base_price": 9000,
      "price_unit": "円/箱",
      "stock_info": { // 在庫情報は集計して表示
        "total_package_count": 5, // 在庫箱数
        "total_actual_weight_kg": 25.4 // 在庫総重量
      },
      "lots": [
        {
          "lot_id": "lot_240518_001", // これが「動的SKU」の実体
          "arrival_date": "2024-05-18",
          "actual_weight_kg": 5.1,
          "billing_weight_kg": 5.0,
          "package_count": 1,
          "unit_price": 8800,
          "kg_price": 1760,
          "origin_name": "北海道 函館港",
          "fisherman_name": "山田 太郎",
          "status": "在庫",
          "notes": "実測3尾"
        },
        {
          "lot_id": "lot_240518_002",
          "arrival_date": "2024-05-18",
          "actual_weight_kg": 4.9,
          "billing_weight_kg": 5.0,
          // ... 他のロット情報 ...
        }
      ]
    },
    {
      // ... 他のバリアント（例：単品売り、冷凍フィレなど）の情報 ...
    }
  ]
}
```

### このモデルがもたらす革新

*   **粒度の自在なコントロール:**
    *   **経営層向け（粗い粒度）:** トップレベルの`product_name`と、集計された`variants`の`stock_info`を見ることで、商品全体の在庫状況を瞬時に把握できます。
    *   **営業・販売向け（中くらいの粒度）:** `variants`のリストを見ることで、「ヒラメの5kg箱/3-4尾入り」という規格が「在庫5箱、基準価格9,000円」であることを顧客に即答できます。
    *   **品質・在庫管理向け（細かい粒度）:** `lots`のリストを見ることで、個々のロット（箱）の入荷日、実重量、仕入れ価格、生産者などの詳細なトレーサビリティ情報を追跡できます。

*   **動的SKUの自然な実装:**
    `lot_id`が、日々の入荷（トランザクション）ごとに一意に生成される「動的SKU」として機能します。これはシステムの中核でありながら、データ構造の中に自然な形で組み込まれています。

*   **現実の商慣習への完全対応:**
    `actual_weight_kg`（実重量）と`billing_weight_kg`（請求重量）を分離して管理することで、「目方」の概念や、規格重量での値決め取引といった、業界特有の複雑な商慣習をデータとして正確に記録できます。

*   **究極の拡張性:**
    「加工方法」「温度帯」「パッケージ種別」「入数規格」といった属性が全て独立したフィールド（ID）で管理されているため、将来新しい属性が増えても、マスタとフィールドを追加するだけで柔軟に対応可能です。システムの根幹を揺るがすことなく、成長し続けることができます。



## 3. プロジェクトのゴール

**Project DynSea SKU** は、この階層的データモデルを中核に据え、以下のゴールを実現します。

1.  **あらゆる粒度の要求に応える情報基盤の構築:**
    経営判断に必要なマクロな視点から、トレーサビリティ確保に必要なミクロな視点まで、一つのデータソースで対応する。
2.  **現場の負担を最小化するデータ入力フローの実現:**
    入力する情報は一つでも、システムが自動的に階層構造を整理し、各場面で最適な情報を提供する。
3.  **データによる新たな価値創造:**
    これまで見えなかった「規格外品」の隠れた需要を発見したり、詳細なデータに基づいた付加価値の高い商品提案を可能にする。

## 4. 現在のステータスとロードマップ

私たちは今、この革新的なアプローチの有効性を証明するための段階にいます。

-   [x] **Phase 0: 課題の再定義とコンセプト確立**
    -   [x] 「粒度の柔軟性」という本質的課題の特定。
    -   [x] 階層的データモデルの基本構想完了。
-   [ ] **Phase 1: データモデルの設計とプロトタイピング (現在進行中)**
    -   [ ] 主要魚種を対象とした具体的なJSONスキーマの設計。
    -   [ ] 簡易的なデータ登録・閲覧ツールの開発を通じた操作性の検証 (PoC)。
    -   [ ] 粒度別データ出力APIの試作と検証。
-   [ ] **Phase 2: MVP（Minimum Viable Product）開発**
    -   [ ] 階層データを本格的に扱えるデータベースとAPIの構築。
    -   [ ] パイロット導入と効果測定。
-   [ ] **Phase 3: 本格展開とデータ活用の深化**
    -   [ ] 全社・全部門への展開と、データ分析基盤の構築。

詳細は [Projects](link-to-your-project-board) ボードで管理しています。

非常に鋭く、本質的なご指摘だと思います！おっしゃる通り、このプロジェクトの核心は「動的SKU」という言葉そのものよりも、**「要求される情報の『粒度』に柔軟に対応できるデータ構造」**にあると言えます。

「粒度の違い」という視点は、これまでの議論をさらに深化させる素晴らしい気づきです。そして、その解決策として**JSONのような階層構造でデータを管理する**というアイデアは、まさにこの問題に対するエレガントなアプローチです。

この考え方を整理し、検証していくためのドキュメントを作成しましょう。

---

**3. 検証計画：1つずつ検証していくために**

この新しいデータモデルの有効性を検証するため、以下のステップで進めることを提案します。

*   **ステップ1：データモデルの設計とプロトタイピング (1-2週間)**
    *   **目的:** 主要な魚種（例：ヒラメ、サバ、ホッケ）を対象に、階層的データモデルの具体的なスキーマを設計する。
    *   **手法:** 実際にJSONファイルとしてデータを作成し、様々な粒度での情報出力が問題なく行えるかを手元でシミュレーションする。
    *   **成果物:** 標準的なデータモデルのJSONスキーマ定義。
*   **ステップ2：簡易的なデータ登録・閲覧ツールの開発 (PoC) (1ヶ月)**
    *   **目的:** 現場担当者がこの階層データを実際に入力・閲覧できるか、その操作性を検証する。
    *   **手法:** Google Apps Scriptとスプレッドシート、または簡易的なWebアプリを開発。トップレベルの情報と、`variants`レベルの情報を入力すると、`lots`（動的SKU）が自動的に登録されるような仕組みを試作する。
    *   **成果物:** プロトタイプツール、現場からのフィードバックレポート。
*   **ステップ3：APIによる粒度別データ出力の検証 (PoC)**
    *   **目的:** 開発したツールから、要求された粒度に応じて適切なデータを返すAPIのエンドポイントを試作し、その有効性を検証する。
    *   **手法:**
        *   `/products/PROD-HIRAME` → 粗い粒度の情報を返す
        *   `/products/PROD-HIRAME/variants` → 中くらいの粒度の情報を返す
        *   `/lots/LOT-240515-001` → 細かい粒度の情報を返す
    *   **成果物:** APIの仕様書（ドラフト）、APIの動作検証レポート。

**4. 結論：真の課題は「粒度の制御」**

「Project DynSea SKU」が解決すべき真の課題は、「SKUの多さ」そのものではなく、**「ビジネスの場面ごとに要求される情報の粒度を、柔軟かつ効率的に制御できないこと」**です。

JSONライクな階層的データモデルは、この本質的な課題に対する強力な解決策となり得ます。このモデルを中核に据えることで、「動的SKU」の概念をより洗練された形でシステムに組み込み、真に柔軟で拡張性の高いデータ基盤を構築できると確信しています。

まずは、提案した検証計画に沿って、このアプローチの有効性を一つずつ証明していきましょう。


## 5. 開発とコントリビューション

このプロジェクトは、水産業界の未来を本気で変えたいと考えるすべての人のためのものです。

### 開発環境

*   **コアコンセプト:** 階層的データモデル (JSON-like)
*   **バックエンド:** Node.js / Python, サーバーレス, PostgreSQL (JSONB)
*   **フロントエンド:** React / Vue.js
*   **インフラ:** Google Cloud / AWS
*   **開発ツール:** Cursor, GitHub, etc.

セットアップ手順の詳細は [`SETUP.md`](SETUP.md) を参照してください。

### 貢献方法

バグ報告、機能提案、ドキュメントの改善、そしてもちろんコードによる貢献も大歓迎です。
詳細は [`CONTRIBUTING.md`](CONTRIBUTING.md) をご覧ください。


